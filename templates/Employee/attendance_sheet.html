{% extends 'base.html' %}
{% block content %}
{% load static %}

<style>
    #attendanceSheet {
        border-collapse: collapse;
        width: 80%;
        margin: 30px;
    }
    #attendanceSheet th, #attendanceSheet td {
        border: 1px solid black;
        padding: 8px;
        text-align: center;
    }
    #logButton {
        padding: 20px;
        background-color: rgb(255, 166, 0);
        color: white;
        border: none;
        cursor: pointer;
    }
</style>

<h1 style="text-align: center;">Employee Attendance</h1>
<form method="post" action="{% url 'attendance_sheet' %}">
    {% csrf_token %}
    {% if loggedIn %}

    {% else %}
    <div id="logButtons">
        <button class="btn btn-primary" id="loginButton" name="action" value="login" >Log In</button>
        <button class="btn btn-primary" id="logoutButton" name="action" value="logout" style="display: none;">Log Out</button>
    </div>
    {% endif %}
</form>

<table id="attendanceSheet">
    <thead>
        <tr>
            <th>Date</th>
            <th>Login Time</th>
            <th>Logout Time</th>
        </tr>
    </thead>
    <tbody id="attendanceData">
        {% for attendance_record in employee_attendance %}
        <tr>
            <td>{{ attendance_record.date }}</td>
            <td>{{ attendance_record.login_time }}</td>
            <td>{{ attendance_record.logout_time }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
    let loggedIn = {{ loggedIn|yesno:"true,false" }};
    const attendanceData = document.getElementById('attendanceData');
    const loginButton = document.getElementById('loginButton');
    const logoutButton = document.getElementById('logoutButton');

    function toggleLogInOut(action) {
        if (action === 'login') {
            // User is logging in
            const loginTime = new Date().toLocaleTimeString();
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>${new Date().toLocaleDateString()}</td>
                <td>${loginTime}</td>
                <td></td>
            `;
            attendanceData.appendChild(newRow);
            loginButton.style.display = 'none';
            logoutButton.style.display = 'block';
            loggedIn = true;
        } else if (action === 'logout') {
            // User is logging out
            const logoutTime = new Date().toLocaleTimeString();
            const lastRow = attendanceData.lastElementChild;
            if (lastRow) {
                lastRow.children[2].textContent = logoutTime;
            }
            loginButton.style.display = 'block';
            logoutButton.style.display = 'none';
            loggedIn = false;
        }
    }
    if (localStorage.getItem('loggedIn')) {
        // If the user was logged in previously, show the appropriate button
        loginButton.style.display = 'none';
        logoutButton.style.display = 'block';
    }
    loginButton.addEventListener('click', function() {
        toggleLogInOut('login');
        localStorage.setItem('loggedIn', 'true');
    });

    logoutButton.addEventListener('click', function() {
        toggleLogInOut('logout');
        localStorage.removeItem('loggedIn');
    });
</script>
{% endblock %}
